# Static Malware Analysis - Practical Guide

## What is Static Malware Analysis?
Static malware analysis involves **examining a malware sample without executing it.** It helps in identifying the structure, strings, and potential behavior of malware safely.

---

## Setting Up a Secure Analysis Environment
### 1. **Use an Isolated Virtual Machine**
   - Install **Kali Linux** or **REMnux** in **VirtualBox** or **VMware**.
   - Disable internet access to prevent accidental execution risks.
   - Use **Snapshots** to revert changes quickly.

### 2. **Get a Malware Sample** (For Testing & Learning)
   - Download test samples from safe sources like **TheZoo, VX Underground, MalwareBazaar**.
   - Never use real-world active malware on a personal machine.

---

## Tools for Static Malware Analysis
| Tool | Purpose |
|------|---------|
| **VirusTotal** | Online malware scanning |
| **PEStudio** | Windows PE file analysis |
| **Exeinfo PE** | Identify compiler & packer |
| **strings** | Extract readable strings |
| **Binwalk** | Analyze binary files |
| **Ghidra / IDA Pro** | Reverse engineering |
| **YARA** | Malware signature detection |

---

## Step-by-Step Static Analysis
### 1. **Identify File Type**
```bash
file malware_sample.exe
```
- Check if it's a **Windows EXE, DLL, Python script, or ELF binary**.

### 2. **Check Hashes for Reputation Analysis**
```bash
sha256sum malware_sample.exe
md5sum malware_sample.exe
```
- Submit hash to **VirusTotal** or **MalwareBazaar** to see existing reports.

### 3. **Extract Strings to Find Suspicious Artifacts**
```bash
strings -n 10 malware_sample.exe | less
```
- Look for:
  - **Suspicious domains/IPs**
  - **Hardcoded commands (e.g., `cmd.exe`)**
  - **Suspicious registry modifications**

### 4. **Check PE Headers and Sections (For Windows Malware)**
```bash
pesieve64.exe -d malware_sample.exe
```
- Identify **packers, imports, and suspicious sections**.
- Look for **encrypted or compressed data sections**.

### 5. **Detect Packers & Compression**
```bash
upx -t malware_sample.exe
```
- If packed, try unpacking:
```bash
upx -d malware_sample.exe
```
- Use **Exeinfo PE** or **Detect It Easy (DIE)** for more packer details.

### 6. **Inspect Code with Ghidra or IDA Pro**
- Load the sample in **Ghidra**.
- Look for **API calls**, **functions**, and **suspicious loops**.
- Check for **hardcoded encryption routines**.

### 7. **Check for YARA Rules** (Malware Detection)
```bash
yara -r myrules.yar malware_sample.exe
```
- Create custom **YARA rules** to detect malware patterns.

---

## Key Indicators to Look For
- **Suspicious API calls** (`CreateProcess`, `VirtualAlloc`, `WriteProcessMemory`)
- **Embedded IPs, domains, or URLs**
- **Encoded strings or XOR operations**
- **Usage of unusual ports**

---

## Practical Exercise for Students
1. Set up a VM with Kali Linux.
2. Download a **test malware sample** from **TheZoo**.
3. Perform **hash analysis** and submit it to **VirusTotal**.
4. Use **strings** to extract readable text.
5. Analyze PE structure using **PEStudio**.
6. Identify packers using **Exeinfo PE**.
7. Reverse engineer the binary using **Ghidra**.
8. Create a custom **YARA rule** to detect similar threats.

---

## Conclusion
Static malware analysis is a **safe and effective method** to understand malware without executing it. By analyzing file structures, extracting strings, and identifying suspicious patterns, security analysts can detect potential threats efficiently.
